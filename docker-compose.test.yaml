# This override file should be used when running automated tests so
# that test output is saved to the host

services:
  aphw-ddi-api:
    build:
      target: development
    image: aphw-ddi-api-development
    container_name: aphw-ddi-api-test
    command: npm run test
    volumes:
      - ./app:/home/node/app
      - ./test:/home/node/test
      - ./test-output:/home/node/test-output
      - ./jest.config.js:/home/node/jest.config.js
      - ./package.json:/home/node/package.json
    depends_on:
        - aphw-ddi-api-azurite
    environment:
      AZURE_STORAGE_CONNECTION_STRING: "DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;BlobEndpoint=http://aphw-ddi-api-azurite:10000/devstoreaccount1"
      OS_PLACES_API_KEY: ${OS_PLACES_API_KEY:-test}
      OS_PLACES_API_BASE_URL: ${OS_PLACES_API_BASE_URL:-test}
      POLICE_API_BASE_URL: ${POLICE_API_BASE_URL:-test}
      PACT_BROKER_URL: ${PACT_BROKER_URL:-notset}
      PACT_BROKER_USERNAME: ${PACT_BROKER_USERNAME:-notset}
      PACT_BROKER_PASSWORD: ${PACT_BROKER_PASSWORD:-notset}
      # Fake public keys for testing
      PORTAL_PUBLIC_KEY: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUF4N0h4QURxQU5LT2FMbUhNUDVsWQplOHdBeTVRN1NmQ1FTNVA0SlRNMUt0VG9KL0JZSG0vQkVFSk8xNTgvbitOTGVEQlA4Y241eXJ3SElUenZiSDFkCk41T0xGb1JncFNrdkJ5RElpalQyVTZMTGpkYUxhSmVObXZzNFBwaUdxN0xTSHBCaWlaQzJhdHA3azhhV0JWMU8KVHRFNTBkY2MzdXpTZ0x6ZmY1akhtb21pdm9Sc0M4emV6c2ZwWjVxUDVQU2ROL2I2ZFBPVzY1TjNDUTFFNjEzYwpoZ1phdVE3NzJSOVlVcFQvbWVxbkYxc1BGQWE5QlFFSURRRCsxaFp3RGdIM1MzMlNGNDJvSENDU2tqUmw3Nyt3Cnc4emFqZ0wzbld4WFBYM0NCck5lNHAySEZhVDU4ODQ3TlhZSDFTR3REbFZ6K2pyanhYNzRwTDR0aXpOV2dmZWoKN3dJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=="
      ENFORCEMENT_PUBLIC_KEY: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUFrMFRRMlRSOUFWL3pBc0tMOFBBTApRU0UvZ005S082YUg4dEcvYnREZU5adTFRV3h4UGF3ZGttMWE4czBIbndaV3lsbzRuYjhZM2tadzRIMWxsQkxqCmFCaWRwTXMzMXNXZGNiaTFLTExiOWN4MGVQRGZVWHk0eTJlTjFYMC9LZ2xUSUhpWm4yME4wM0RBaUJVUzVzYloKdEtnVnJaM3FCRG9YUDIvTG1aV0FoYTFLRmhiSlFmeU1hTWZEUW51bVByNkx6K3ZvaU5PdGRnbkJrOUtOdk1iWgphSERxMHVSWUk4ckpEdzJkNHg4a2xSc1ltRnIwQ3JhSmhVSFdCV1NBUjNJWjRLTVRNUlIrRCs1NCt2TUJ4TldICm1WeHNQTVNDS3ZMSUlvUUpJNzJ2NXlWOFVqVmplbG5mbW9JYTRvZTZhUG5qYkRCUDNJWlVmdkRkdSt3WTZhdXoKV1FJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=="
      API_PRIVATE_KEY: "LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2Z0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktnd2dnU2tBZ0VBQW9JQkFRRFdKTCs3TExDMmx0SlAKTkdvb0FzUTE2Y0l2R2hzU0lub2liRHQ2TGhtdFdqRWtYb1M3UUxOS0VhYzIyRXdwSjRDcTZ1cHRRSmtRSCsyVQpnNmltNko2aUVwR0hMZENoQVJlMFNhNVlWcUdiZzd1cDkrbGlXMkNiQkZsV3FVeEg4ZEorZUlIL3BCVEJ5Y3VtCkdDcHdvd1FUZlFCZDNrUmVXOEllU3lGZWJUMm9BVUw4YTZEMFBsTTJydThEb25ZeXY4QzJtcU5QVzNNU3NINVIKd1J1WlhBZWlxa1Y4RWxkOGc3OStJY0pXM0g1L081a2J3Z1RuUDhFYkI2MldHMklBa2twQWdnWXdxem8vUjhqUAo2dzY4Q0JNK29oZ3UvU1Aza2xxM2hUanRTbFFxM3N2ZlRVTlVaNmlLQ0hOQkhYRmlyUGRGUlVYT0xIMGpvb2xVCjZnZjEzSDM5QWdNQkFBRUNnZ0VBQXlsZWthS2hYRWRzbWt5WU9hTFZmSm56Z0QyeGd4L0hyNnpyUERkUE1UMlkKNXFRazc3SjVtSUViWW51b2lqTlhXcmxSQUkvRGdzR3ZRTEg5N04yWDJWQTVYbEVqN2Z0RnV6ekZsUnA0VklNSwpJNjBHNjM1cVlNemNZeU5vNlNkWWw5TkFlMjFUMGlCSzFheGJLZzBQYThNOHgyWUI3K1plYVdpV0Rra1hiOXpICitTMmZneEtpWWZQclV2MXB3WnhLL3JZV1pCL2Q5L0xTQUtveWQrQmNqQ1B2RnYwbXZiY0k4ZG1UTE5hYU1RNHoKUlBqV2tvOWpWRmhGYUdCOWZMVEFNVE9Db0NTQzlrLzFWQkVwMm5WUjBPQnAzbU9scDJGVDN4KzVza2RNbi9yQgpZUWRJelo3Z1RKaGxXbFVpRGsxWXB2M0tPUVlYaW40YTNYTHhuVjNXRVFLQmdRRDhOeUNqWW9SWXpSeTQwUTZ3Cm1TVmlkSWM5SWpQV0VUam1ia1R5MjNJL0kxVWpHUkxqNktjNzBVaTJVSFpLWGpaQktGQnhyb1Y0ckxnSW13NGYKeGNnbDFiWUZNWW14RFpFZmdUOElmMGJZelZ4Vmh5WXgrS1VTOHdkWmtOQWd6VjhhZmJMKysvRzdqd0N6eisyNQpqSk5rWlBTTVJ1b0gxMlpQWWc2d05lNmlqUUtCZ1FEWlcxN2ZJcHdTSFBDL0k5bzlETlhOekZFOUo2OUZ2b1RiCmJQMXZrQk9FclZScGQ5QkdJTGd6K3RsQ3hYQTZRcjBwRTBaT0ZYQnQyZHRpWm9UY2Zma25VWFJHd3FPUjF1c3EKSmtLUlNNVHlzTFhQVWJ6Zmd5ZHJyTEsvUjhEWW01aURLTm9OYlVydVlJM1Y5WHA5bEpsVkRXV1hlQ082WldYSAowRXE4R0xVbE1RS0JnUUN4ZDVETnBpcDkyWVdXUGZQYUswaDA2STJvWklLWTQvRm5vcnQ5THhCS2dQQU5ERDJRCmhFbjMreUR3dDlra0p2cUNDbjNnSCs3bXBKR3g3SGladnE5QWdBbmR5YWViSDNLMytsZUNBUnkydkhsMTdPemgKU0pYT3FaYklYTzgxeFl4ZnRZYlhpQ3ZsejQrczltZk5vYTZzZTZUZmQ1NkErZjJSYWV2djdXTUdtUUtCZ1FETwpVQk5pVzVpbS9MOXJ2dDFGTzZ5cDFubDZRZlAxa0p6TkpzdjlIRlhhaHlmcm9HV2FXeTVkY0lyTy9WZkVoVnJGCjVWekRlMGdualRYWFZoWmdzRlpTQXRnSzNtK2lXODBHU2lDL2hNSWsxcVVNYjdxR3NoZzE5VXdKa2xNemg2V2gKUWFLUVFpQncya2RuUXNZTTg0TURuMTdDQXJCdkdoWWRMdEh4YnNacTBRS0JnSFZIUlJKY2RKSVVsSU9uaWZhNQpYS1FyZUNLa3VkWEtLY2dmaGt5UllrVVIrcFp1ZFA4SXZSSEFiVmRQQjU1emFNUHZyUlBmY1VGcnQyQk9RMDdNCmVnUHNLVnVremdkVUVSVU5MUEszYzEyK1FLQ0IwaTRkaWFPRUVzMDRoTGRNWVFYdW9waUZwT0VxMlRiRk1BRHgKRHVFbUpzaUxjSkZVOEVYMytLOXlxRnVhCi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0K"
      API_PUBLIC_KEY: "LS0tLS1CRUdJTiBQVUJMSUMgS0VZLS0tLS0KTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUExaVMvdXl5d3RwYlNUelJxS0FMRQpOZW5DTHhvYkVpSjZJbXc3ZWk0WnJWb3hKRjZFdTBDelNoR25OdGhNS1NlQXF1cnFiVUNaRUIvdGxJT29wdWllCm9oS1JoeTNRb1FFWHRFbXVXRmFobTRPN3FmZnBZbHRnbXdSWlZxbE1SL0hTZm5pQi82UVV3Y25McGhncWNLTUUKRTMwQVhkNUVYbHZDSGtzaFhtMDlxQUZDL0d1ZzlENVROcTd2QTZKMk1yL0F0cHFqVDF0ekVyQitVY0VibVZ3SApvcXBGZkJKWGZJTy9maUhDVnR4K2Z6dVpHOElFNXovQkd3ZXRsaHRpQUpKS1FJSUdNS3M2UDBmSXorc092QWdUClBxSVlMdjBqOTVKYXQ0VTQ3VXBVS3Q3TDMwMURWR2VvaWdoelFSMXhZcXozUlVWRnppeDlJNktKVk9vSDlkeDkKL1FJREFRQUIKLS0tLS1FTkQgUFVCTElDIEtFWS0tLS0tCg=="
      AUTH_SERVER_URL: https://example.com
      USER_FEEDBACK_EMAIL_ADDRESS: dummy@here.com
      ENFORCEMENT_URL: https://enforcement.com

  aphw-ddi-api-azurite:
    image: mcr.microsoft.com/azure-storage/azurite:3.23.0

  aphw-ddi-api-postgres:
    volumes:
      - postgres_data:/var/lib/postgresql/data

volumes:
  postgres_data: