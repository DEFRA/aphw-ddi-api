1. Prior to running the import process, run script A and script B in target DB (e.g. DEV/TST/PROD) and save the outputs for later
2. In your LOCAL DB, run the result of script A (alter sequence statements)
3. In your LOCAL DB and env, run the import process to import spreadsheet data into the LOCAL DB using the API and a Postman call
4. In your LOCAL DB, run the result of script B (create table statements)
5. If not already exists, create a .pgpass file in your home directory (to prevent being prompted for the password) with the contents of
localhost:5432:aphw-ddi:postgres:ppp
6. Run script C in your LOCAL CLI (perhaps in a new folder)
7. Check that export files have been created
8. Run script D in the same folder as script C was run
9. Connect pgAdmin to the target DB (e.g. DEV, TST, PROD)
10. Open and run each SQL file (files from step 8) in the following order:
dog_export.sql
person_export.sql
registered_person_export.sql
contact_export.sql
person_contact_export.sql
address_export.sql
person_address_export.sql
insurance_export.sql
registration_export.sql
microchip_export.sql
dog_microchip_export.sql
search_index_export.sql
11. If desired, run script E against your LOCAL DB to drop the temporary tables

-- Script A
-- Run this query in target DB to produce a script - PRIOR to running import
SELECT 'ALTER SEQUENCE address_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from address) || ';'
UNION
SELECT 'ALTER SEQUENCE contact_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from contact) || ';'
UNION
SELECT 'ALTER SEQUENCE dog_microchip_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from dog_microchip) || ';'
UNION
SELECT 'ALTER SEQUENCE insurance_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from insurance) || ';'
UNION
SELECT 'ALTER SEQUENCE microchip_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from microchip) || ';'
UNION
SELECT 'ALTER SEQUENCE person_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from person) || ';'
UNION
SELECT 'ALTER SEQUENCE person_address_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from person_address) || ';'
UNION
SELECT 'ALTER SEQUENCE person_contact_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from person_contact) || ';'
UNION
SELECT 'ALTER SEQUENCE registered_person_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from registered_person) || ';'
UNION
SELECT 'ALTER SEQUENCE registration_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from registration) || ';'
UNION
SELECT 'ALTER SEQUENCE search_index_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from search_index) || ';'
ORDER BY 1

-- Script B
-- Run this query in target DB to produce a script - PRIOR to running import
UNION
SELECT 'CREATE TABLE address_export AS SELECT * FROM address WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from address) || ';'
UNION
SELECT 'CREATE TABLE contact_export AS SELECT * FROM contact WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from contact) || ';'
UNION
SELECT 'CREATE TABLE dog_export AS SELECT * FROM dog WHERE id < 300000;'
UNION
SELECT 'CREATE TABLE dog_microchip_export AS SELECT * FROM dog_microchip WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from dog_microchip) || ';'
UNION
SELECT 'CREATE TABLE insurance_export AS SELECT * FROM insurance WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from insurance) || ';'
UNION
SELECT 'CREATE TABLE microchip_export AS SELECT * FROM microchip WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from microchip) || ';'
UNION
SELECT 'CREATE TABLE person_export AS SELECT * FROM person WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from person) || ';'
UNION
SELECT 'CREATE TABLE person_address_export AS SELECT * FROM person_address WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from person_address) || ';'
UNION
SELECT 'CREATE TABLE person_contact_export AS SELECT * FROM person_contact WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from person_contact) || ';'
UNION
SELECT 'CREATE TABLE registered_person_export AS SELECT * FROM registered_person WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from registered_person) || ';'
UNION
SELECT 'CREATE TABLE registration_export AS SELECT * FROM registration WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from registration) || ';'
UNION
SELECT 'CREATE TABLE search_index_export AS SELECT * FROM search_index WHERE id >= ' || (SELECT COALESCE(max(id) + 1, 1) from search_index) || ';'
ORDER BY 1

-- Script C
--Run in your LOCAL CLI
pg_dump -U postgres -d aphw-ddi --data-only --table=address_export -p 5432 -h localhost --column-inserts > address_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=contact_export -p 5432 -h localhost --column-inserts > contact_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=dog_export -p 5432 -h localhost --column-inserts > dog_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=dog_microchip_export -p 5432 -h localhost --column-inserts > dog_microchip_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=insurance_export -p 5432 -h localhost --column-inserts > insurance_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=microchip_export -p 5432 -h localhost --column-inserts > microchip_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=person_address_export -p 5432 -h localhost --column-inserts > person_address_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=person_contact_export -p 5432 -h localhost --column-inserts > person_contact_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=person_export -p 5432 -h localhost --column-inserts > person_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=registered_person_export -p 5432 -h localhost --column-inserts > registered_person_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=registration_export -p 5432 -h localhost --column-inserts > registration_export.sql
pg_dump -U postgres -d aphw-ddi --data-only --table=search_index_export -p 5432 -h localhost --column-inserts > search_index_export.sql

-- Script D
-- Run in your LOCAL CLI
sed -i '' "s/address_export/address/g" address_export.sql
sed -i '' "s/contact_export/contact/g" contact_export.sql
sed -i '' "s/dog_export/dog/g" dog_export.sql
sed -i '' "s/dog_microchip_export/dog_microchip/g" dog_microchip_export.sql
sed -i '' "s/insurance_export/insurance/g" insurance_export.sql
sed -i '' "s/microchip_export/microchip/g" microchip_export.sql
sed -i '' "s/person_export/person/g" person_export.sql
sed -i '' "s/person_address_export/person_address/g" person_address_export.sql
sed -i '' "s/person_contact_export/person_contact/g" person_contact_export.sql
sed -i '' "s/registered_person_export/registered_person/g" registered_person_export.sql
sed -i '' "s/registration_export/registration/g" registration_export.sql
sed -i '' "s/search_index_export/search_index/g" search_index_export.sql


-- script E
-- RUn against your LOCAL DB to clear up temporary tables
drop table address_export;
drop table contact_export;
drop table dog_export;
drop table dog_microchip_export;
drop table insurance_export;
drop table microchip_export;
drop table person_address_export;
drop table person_contact_export;
drop table person_export;
drop table registered_person_export;
drop table registration_export;
drop table search_index_export;

-- script F
--
SELECT 'ALTER SEQUENCE address_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from address) || ';'
UNION
SELECT 'ALTER SEQUENCE contact_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from contact) || ';'
UNION
SELECT 'ALTER SEQUENCE dog_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from dog) || ';'
UNION
SELECT 'ALTER SEQUENCE dog_microchip_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from dog_microchip) || ';'
UNION
SELECT 'ALTER SEQUENCE insurance_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from insurance) || ';'
UNION
SELECT 'ALTER SEQUENCE microchip_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from microchip) || ';'
UNION
SELECT 'ALTER SEQUENCE person_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from person) || ';'
UNION
SELECT 'ALTER SEQUENCE person_address_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from person_address) || ';'
UNION
SELECT 'ALTER SEQUENCE person_contact_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from person_contact) || ';'
UNION
SELECT 'ALTER SEQUENCE registered_person_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from registered_person) || ';'
UNION
SELECT 'ALTER SEQUENCE registration_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from registration) || ';'
UNION
SELECT 'ALTER SEQUENCE search_index_id_seq RESTART WITH ' || (SELECT COALESCE(max(id) + 1, 1) from search_index) || ';'
ORDER BY 1
